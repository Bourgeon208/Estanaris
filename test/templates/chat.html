{% extends 'base.html' %}

{% block content %}
    <h1>IRC Chat</h1>
    <div id="message-box">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>

    <form id="message-form">
        <input type="text" id="message-input" autocomplete="off" />
        <button type="submit">Send</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var messageForm = document.getElementById('message-form');
            var messageInput = document.getElementById('message-input');
            var messageBox = document.getElementById('message-box');

            messageForm.addEventListener('submit', function(e) {
                e.preventDefault();
                var message = messageInput.value;
                if (message.trim() !== '') {
                    fetch('/send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'message=' + encodeURIComponent(message)
                    });
                    messageInput.value = '';
                }
            });

            function displayMessage(message) {
                var messageElement = document.createElement('p');
                messageElement.textContent = message;
                messageBox.appendChild(messageElement);
            }

            // Polling mechanism to fetch new messages every 2 seconds
            function pollForMessages() {
                fetch('/').then(function(response) {
                    return response.text();
                }).then(function(data) {
                    messageBox.innerHTML = data;
                }).catch(function(error) {
                    console.error('Error fetching chat messages:', error);
                }).finally(function() {
                    setTimeout(pollForMessages, 2000);
                });
            }

            pollForMessages();
        });
    </script>
{% endblock %}

